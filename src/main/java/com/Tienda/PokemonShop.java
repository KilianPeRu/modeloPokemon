/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package com.Tienda;

import com.BattleCPU.resources.Pokemon;
import com.Iniciador.initialMenu;
import com.PokemonContainer.PCLoader;
import com.PokemonContainer.pokeComparator;
import com.Recursos.Modifiers.RoundBorder;
import com.Recursos.reusableCode.pokemonInterface;

import javax.sound.sampled.AudioSystem;
import javax.sound.sampled.Clip;
import javax.sound.sampled.LineUnavailableException;
import javax.swing.*;
import java.awt.*;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.StringSelection;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.sql.SQLException;
import java.util.ArrayList;

/**
 *
 * @author exosh
 */
public class PokemonShop extends JFrame {
    PCLoader pcl = new PCLoader();
    ArrayList<Pokemon> teamUser;
    ArrayList<Pokemon> PCPokemon;
    Clip clip = AudioSystem.getClip();
    String username;
    String id;

    /**
     * Creates new form PokemonContainerGUI
     */
    public PokemonShop(ArrayList<Pokemon> equipo, String name, String id) throws LineUnavailableException, SQLException, ClassNotFoundException {
        this.teamUser = equipo;
        this.username = name;
        this.PCPokemon = pcl.loadPC("shop");
        this.id = id;
        initComponents();
        iniciar();
        setLocationRelativeTo(null);
        //setResizable(false);
        setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);
        addWindowListener(new WindowAdapter() {
            @Override
            public void windowClosing(WindowEvent e) {
                try {
                    new initialMenu(username,clip,false, id).setVisible(true);
                } catch (SQLException ex) {
                    throw new RuntimeException(ex);
                } catch (ClassNotFoundException ex) {
                    throw new RuntimeException(ex);
                }
            }
        });
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new JPanel();
        title = new JPanel();
        titleLabel = new JLabel();
        userProfile = new JPanel();
        userName = new JLabel();
        userID = new JButton();
        image = new JButton();
        scrollPanel = generateScroller();

        setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);

        jPanel1.setBackground(new Color(255, 102, 102));
        jPanel1.setLayout(new BorderLayout());

        title.setBackground(jPanel1.getBackground());

        titleLabel.setBackground(new Color(255, 255, 255));
        titleLabel.setHorizontalTextPosition(SwingConstants.CENTER);
        titleLabel.setOpaque(true);

        userName.setFont(new Font("Segoe UI", 0, 14)); // NOI18N
        userName.setText("name");

        userID.setText("uuid");
        userID.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                userIDActionPerformed(evt);
            }
        });

        image.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent evt) {
                imageActionPerformed(evt);
            }
        });

        GroupLayout userProfileLayout = new GroupLayout(userProfile);
        userProfile.setLayout(userProfileLayout);
        userProfileLayout.setHorizontalGroup(
            userProfileLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(GroupLayout.Alignment.TRAILING, userProfileLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(image, GroupLayout.DEFAULT_SIZE, 88, Short.MAX_VALUE)
                .addGap(18, 18, 18)
                .addGroup(userProfileLayout.createParallelGroup(GroupLayout.Alignment.LEADING, false)
                    .addComponent(userName, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(userID, GroupLayout.DEFAULT_SIZE, 105, Short.MAX_VALUE))
                .addContainerGap())
        );
        userProfileLayout.setVerticalGroup(
            userProfileLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(userProfileLayout.createSequentialGroup()
                .addGap(25, 25, 25)
                .addComponent(userName)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(userID)
                .addContainerGap(26, Short.MAX_VALUE))
            .addGroup(userProfileLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(image, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );

        GroupLayout titleLayout = new GroupLayout(title);
        title.setLayout(titleLayout);
        titleLayout.setHorizontalGroup(
            titleLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(titleLayout.createSequentialGroup()
                .addContainerGap(224, Short.MAX_VALUE)
                .addComponent(titleLabel, GroupLayout.PREFERRED_SIZE, 464, GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED, 77, Short.MAX_VALUE)
                .addComponent(userProfile, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        titleLayout.setVerticalGroup(
            titleLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(titleLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(titleLayout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addGroup(titleLayout.createSequentialGroup()
                        .addComponent(userProfile, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addComponent(titleLabel, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        scrollPanel.setVisible(true);
        jPanel1.add(scrollPanel, BorderLayout.CENTER);

        jPanel1.add(title, BorderLayout.PAGE_START);

        GroupLayout layout = new GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel1, GroupLayout.PREFERRED_SIZE, 700, GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void iniciar() throws SQLException, ClassNotFoundException {
        jPanel1.add(loadTeam(teamUser), BorderLayout.EAST);
    }
    public JScrollPane generateScroller() {
        JScrollPane scroller = new JScrollPane();
        try {
            JPanel containerPanel = loadContainer(); // Cargar el panel con los botones
            scroller.setViewportView(containerPanel); // Establecer el panel como viewportView
        } catch (SQLException | ClassNotFoundException e) {
            throw new RuntimeException(e);
        }
        return scroller;
    }
    public JPanel loadTeam(ArrayList<Pokemon> equipoPokemon) throws SQLException, ClassNotFoundException {
        JPanel team = new JPanel(new GridBagLayout());
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(0, 10, 5, 5); // 5px de padding en todos los lados

        for (int i = 0; i < equipoPokemon.size(); i++) {
            int indice = i;
            gbc.gridx = 0; // Mantenemos la columna en 0
            gbc.gridy = i; // Incrementamos la fila para cada Pokémon

            JButton bttn = new JButton();
            bttn.setPreferredSize(new Dimension(100, scrollPanel.getHeight() / equipoPokemon.size() - 10));
            ImageIcon icon = new ImageIcon("src/main/java/com/Recursos/pokemonImages/" + equipoPokemon.get(i).getEspecie().toLowerCase() + ".png");
            Icon image = new ImageIcon(icon.getImage().getScaledInstance(90, 90, Image.SCALE_DEFAULT));
            bttn.setIcon(image);
            bttn.setBorder(new RoundBorder(9));
            bttn.setBorder(BorderFactory.createCompoundBorder(new RoundBorder(9), BorderFactory.createEmptyBorder(5, 10, 5, 10)));
            bttn.addActionListener(new ActionListener() {
                @Override
                public void actionPerformed(ActionEvent e) {
                    try {
                        new pokemonInterface(teamUser, teamUser.get(indice),clip);
                    } catch (SQLException | ClassNotFoundException ex) {
                        throw new RuntimeException(ex);
                    }
                }
            });
            team.add(bttn, gbc);
        }

        return team;
    }
    public JPanel loadContainer() throws SQLException, ClassNotFoundException {
        JPanel panel = new JPanel(new GridLayout(4,PCPokemon.size()/4,10,10));
        for (int i = 0; i < PCPokemon.size(); i++) {
            int indice = i;
            JButton bttn = new JButton();
            bttn.setPreferredSize(new Dimension(200, 200));
            ImageIcon icon = new ImageIcon("src/main/java/com/Recursos/pokemonImages/" + PCPokemon.get(i).getEspecie().toLowerCase() + ".png");
            Icon image = new ImageIcon(icon.getImage().getScaledInstance(200,200, Image.SCALE_DEFAULT));
            bttn.setIcon(image);
            bttn.setBorder(new RoundBorder(9));
            bttn.addActionListener(new ActionListener() {

                @Override
                public void actionPerformed(ActionEvent e) {
                    try {
                        new pokeComparator(username,PCPokemon.get(indice), teamUser, id);
                        dispose();
                    } catch (SQLException ex) {
                        throw new RuntimeException(ex);
                    } catch (ClassNotFoundException ex) {
                        throw new RuntimeException(ex);
                    }
                }
            });
            panel.add(bttn);
        }
        return panel;
    }
    private void userIDActionPerformed(ActionEvent evt) {//GEN-FIRST:event_userIDActionPerformed
        // TODO add your handling code here:
        StringSelection seleccion = new StringSelection(userID.getText());
        Clipboard portapapeles = Toolkit.getDefaultToolkit().getSystemClipboard();
        portapapeles.setContents(seleccion, null);

        // Mostrar un mensaje de confirmación
        JOptionPane.showMessageDialog(null, "Texto copiado al portapapeles.");
    }//GEN-LAST:event_userIDActionPerformed

    private void imageActionPerformed(ActionEvent evt) {//GEN-FIRST:event_imageActionPerformed
        // TODO add your handling code here:

        System.out.println("This should start the change image profile.");

    }//GEN-LAST:event_imageActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private JButton image;
    private JPanel jPanel1;
    private JScrollPane scrollPanel;
    private JPanel title;
    private JLabel titleLabel;
    private JButton userID;
    private JLabel userName;
    private JPanel userProfile;
    // End of variables declaration//GEN-END:variables
}
